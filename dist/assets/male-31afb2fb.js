import{c as Ee,r as x,t as D,j as e,T as Fe,B as a,A as Pe,C as se,a as Ne,d as q,b as n,e as d,f as re,I as ne,g as ze,D as He,L as Ue,h as M,i as O,k as A,P as y,S as ae,l as E,m as F,n as P,o as N,p as _e,q as Le,s as Ge,R as Qe}from"./v4-74551561.js";import{g as I,a as $,d as X,C as K,b as oe,c as Ye,e as qe,f as Xe,G as f,R as Ke,P as Ve,h as Je,i as Ze,j as et,F as tt,r as st,s as rt,k as nt,l as at}from"./databaseDiagnostic-80cc373d.js";import{d as ie,a as le,b as ot,M as z}from"./Message-321b40ed.js";import{d as ce}from"./Female-84d5811b.js";/* empty css              */const H=["SSS","SS","S","Q","N","W"],v={"👣 恋足":["🧎 跪拜","🦶 足交","👃 闻脚","👅 舔足(无味)","👅 舔足(原味)","🧦 舔袜(无味)","🧦 舔袜(原味)","🤐 袜堵嘴","👞 舔鞋(调教用)","👠 舔鞋(户外穿)","🍽️ 足喂食","💧 喝洗脚水","💦 喝洗袜水","👄 足深喉","🦵 踢打","🦶 裸足踩踏","👠 高跟踩踏"],"👑 性奴":["👅 舔阴","👄 舔肛","🚫 禁止射精","🎭 自慰表演","🔧 器具折磨","💦 舔食自己精液","🍑 肛门插入","⭕️ 扩肛","🕳️ 马眼插入","🎠 木马","🍆 阳具插入"],"🐕 狗奴":["🐾 狗姿","📿 项圈","⛓️ 镣铐","🏠 看门","🐾 狗爬","🦮 室内遛狗","💦 狗撒尿","👅 狗舔食","🍽️ 口吐食","💧 口水","🥄 痰盂","🎭 狗装","🐶 狗叫","👙 内裤套头","👃 舔内裤（原味）","🚬 烟灰缸","🔒 狗笼关押","⛓️ 圈禁饲养","🎠 骑马"],"🎎 性玩具":["🎭 角色扮演","💍 乳环","⭕️ 龟头环","💫 肛环","🔒 贞操锁","🔌 肛塞","✍️ 身上写字（可洗）","📝 身上写字（不洗）","👗 CD异装","✂️ 剃光头","🪒 剃毛","🔧 性工具玩弄","🪑 固定在桌椅上","👤 坐脸","💧 灌肠（温和液体）","⚡️ 灌肠（刺激液体）","📸 拍照/录像（露脸）","📷 拍照/录像（不露脸）","🎯 作为玩具","🪑 作为家具","👔 作为男仆"],"🐾 兽奴":["🐕 兽交","🐺 群兽轮交","🦁 兽虐","🐜 昆虫爬身"],"🌲 野奴":["🌳 野外奴役","🏃 野外流放","🌿 野外玩弄","👀 公共场合暴露","🏛️ 公共场合玩弄","⛓️ 公共场合捆绑","🔧 公共场合器具","🔒 贞操锁","👥 露阳(熟人)","👀 露阳(生人)","🐕 野外遛狗"],"⚔️ 刑奴":["👋 耳光","🎋 藤条抽打","🎯 鞭打","🪵 木板拍打","🖌️ 毛刷","👊 拳脚","🤐 口塞","⛓️ 吊缚","🔒 拘束","🔗 捆绑","😮‍💨 控制呼吸","📎 乳夹","⚖️ 乳头承重","🔗 阴茎夹子","📎 阴囊夹子","⚖️ 阴茎吊重物","⚖️ 阴囊吊重物","🎯 鞭打阳具","🦶 踢裆","🪶 瘙痒","⚡️ 电击","🕯️ 低温滴蜡","🔥 高温滴蜡","📍 针刺","💉 穿孔","👊 体罚","🤐 木乃伊","💧 水刑","🔥 火刑","🧊 冰块","🔥 烙印","✂️ 身体改造","✂️ 阉割"],"💭 心奴":["🗣️ 语言侮辱","🗣️ 语言侮辱","😈 人格侮辱","🧠 思维控制","🌐 网络控制","📢 网络公调"],"🏠 家奴":["⏱️ 短期圈养","📅 长期圈养","👥 多奴调教","👑 多主调教","👥 熟人旁观","👀 生人旁观","😈 熟人侮辱","🗣️ 生人侮辱","😴 剥夺睡眠","🌀 催眠","🧹 家务","👔 伺候"],"🚽 厕奴":["🚽 伺候小便","🚽 伺候大便","🚿 圣水浴","💧 喝圣水","🍽️ 圣水食物","🧻 舔舐厕纸","🛁 黄金浴","🍽️ 吃黄金","🧹 清洁马桶","🩸 吃红金","💉 尿液灌肠"]},it=Ee({palette:{primary:{main:"#6200ea",light:"#9d46ff",dark:"#0a00b6"},secondary:{main:"#ff4081",light:"#ff79b0",dark:"#c60055"},background:{default:"#f8f9fa",paper:"#ffffff"},text:{primary:"#2c3e50",secondary:"#546e7a"}},typography:{h3:{fontWeight:700,marginBottom:"2rem",letterSpacing:"-0.5px",color:"#1a237e"},subtitle1:{color:"text.secondary",marginBottom:"2.5rem",fontSize:"1.1rem"},h5:{fontWeight:600,marginBottom:"1.5rem",color:"#303f9f"}},components:{MuiPaper:{styleOverrides:{root:{transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",borderRadius:"12px","&:hover":{boxShadow:"0 12px 24px rgba(0,0,0,0.1)",transform:"translateY(-4px)"}}}},MuiSelect:{styleOverrides:{root:{backgroundColor:"#fff",borderRadius:"8px","&:hover":{backgroundColor:"#f5f5f5"}}}},MuiButton:{styleOverrides:{root:{borderRadius:"8px",textTransform:"none",fontWeight:600,padding:"8px 24px",transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:"0 6px 12px rgba(0,0,0,0.1)"}}}}}});function lt(){const[g,C]=x.useState({}),[de,U]=x.useState(!1),[xe,l]=x.useState(!1),[he,c]=x.useState(""),[pe,S]=x.useState(!1),[me,ue]=x.useState(""),[fe,T]=x.useState(!1),[ge,W]=x.useState(!1),[V,je]=x.useState(I()),[B,be]=x.useState([]),[j,m]=x.useState(!1),[ye,_]=x.useState(!1),[ve,L]=x.useState(!1),[u,J]=x.useState(null),[Se,Ce]=x.useState(!1),k=x.useRef(null);x.useEffect(()=>{ke(),G()},[]),x.useEffect(()=>{const t=Object.keys(g).length>0;_(t)},[g]);const ke=async()=>{try{const t=$(),s=await D.getLatestTestRecord(t,"male");s&&s.ratings&&(C(s.ratings),c("已加载您的最新测试记录"),l(!0))}catch(t){console.error("加载最新测试记录失败:",t)}},G=async()=>{try{m(!0);const t=$(),s=await D.getUserTestRecords(t);be(s.filter(r=>r.test_type==="male"))}catch(t){console.error("加载测试记录失败:",t),c("加载历史记录失败"),l(!0)}finally{m(!1)}},we=async()=>{try{m(!0);const t=$(),s=I(),r={radarData:ee(),groupedRatings:te(),totalItems:Object.keys(g).length,completedItems:Object.values(g).filter(o=>o!=="").length};await D.saveTestRecord({userId:t,nickname:s,testType:"male",ratings:g,reportData:r}),_(!1),c("测试记录保存成功！"),l(!0),await G()}catch(t){console.error("保存测试记录失败:",t),t.message.includes("Could not find")||t.message.includes("column")||t.message.includes("table")?c('数据库配置有问题，请点击"数据库诊断"检查'):c("保存失败: "+t.message),l(!0)}finally{m(!1)}},Z=async()=>{try{m(!0),L(!0);const t=await st();J(t)}catch(t){console.error("诊断失败:",t),c("诊断失败: "+t.message),l(!0)}finally{m(!1)}},Re=()=>{Ce(!0),c("数据库诊断功能已激活！"),l(!0)},Ie=async t=>{try{m(!0);const s=await D.getTestRecordDetails(t);s&&s.ratings&&(C(s.ratings),T(!1),c("测试记录加载成功"),l(!0))}catch(s){console.error("加载测试记录失败:",s),c("加载记录失败: "+s.message),l(!0)}finally{m(!1)}},We=async t=>{try{m(!0);const s=$();await D.deleteTestRecord(t,s),c("记录删除成功"),l(!0),await G()}catch(s){console.error("删除测试记录失败:",s),c("删除失败: "+s.message),l(!0)}finally{m(!1)}},De=()=>{const t=rt(V);c("昵称更新成功: "+t),l(!0),W(!1)},Me=()=>{C({}),_(!1),c("当前测试已清空"),l(!0)},Oe=(t,s,r)=>{C(o=>({...o,[`${t}-${s}`]:r}))},i=(t,s)=>g[`${t}-${s}`]||"",p=t=>{switch(t){case"SSS":return"#1E3D59";case"SS":return"#2C5530";case"S":return"#37474F";case"Q":return"#455A64";case"N":return"#546E7A";case"W":return"#607D8B";default:return"#90A4AE"}},ee=()=>Object.entries(v).map(([t])=>{const s=v[t],o=s.map(h=>{switch(i(t,h)){case"SSS":return 6;case"SS":return 5;case"S":return 4;case"Q":return 3;case"N":return 2;case"W":return 1;default:return 0}}).reduce((h,w)=>h+w,0)/s.length;return{category:t,value:o,fullMark:6}}),Ae=async()=>{if(k.current)try{const t=document.createElement("div");t.style.position="absolute",t.style.left="-9999px",t.style.width="1200px",t.style.backgroundColor="#ffffff",t.style.padding="40px",document.body.appendChild(t);const s=k.current.cloneNode(!0);t.appendChild(s);const r=document.createElement("style");r.textContent=`
          .MuiGrid-container {
            display: grid !important;
            grid-template-columns: repeat(3, 1fr) !important;
            gap: 16px !important;
            width: 100% !important;
          }
          .MuiGrid-item {
            width: 100% !important;
            max-width: 100% !important;
            flex: none !important;
            padding: 0 !important;
          }
          .MuiPaper-root {
            height: 100% !important;
          }
          .MuiTypography-root {
            font-size: 16px !important;
          }
          .MuiTypography-h4 {
            font-size: 32px !important;
            margin-bottom: 32px !important;
          }
          .MuiTypography-h5 {
            font-size: 24px !important;
            margin-bottom: 16px !important;
          }
          .recharts-wrapper {
            width: 600px !important;
            height: 400px !important;
            margin: 0 auto 32px !important;
          }
        `,t.appendChild(r),await new Promise(b=>setTimeout(b,500));const o=await nt(t,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",width:1200,height:t.offsetHeight,onclone:b=>{b.querySelectorAll(".recharts-wrapper").forEach(Be=>{Be.style.margin="0 auto"})}});document.body.removeChild(t);const h=await new Promise(b=>o.toBlob(b,"image/png",1));if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent))try{if(navigator.share&&navigator.canShare){const Y={files:[new File([h],"M自评报告.png",{type:"image/png"})]};if(navigator.canShare(Y)){await navigator.share(Y),c("图片已准备好分享！"),l(!0);return}}}catch(b){console.error("分享失败:",b)}const R=URL.createObjectURL(h),Q=document.createElement("a");Q.href=R,Q.download="M自评报告.png",Q.click(),URL.revokeObjectURL(R),c("报告已保存为高清图片！"),l(!0)}catch(t){console.error("导出图片错误:",t),c("导出图片失败，请重试"),l(!0)}},$e=async()=>{if(k.current)try{const t=k.current,s={margin:1,filename:"男M自评报告.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"in",format:"a4",orientation:"portrait"}};await at().set(s).from(t).save(),c("报告已成功保存为PDF！"),l(!0)}catch{c("导出PDF失败，请重试"),l(!0)}},Te=(t,s)=>{const r=v[t],o={...g};r.forEach(h=>{o[`${t}-${h}`]=s}),C(o),c(`已将${t}类别下所有选项设置为${s}`),l(!0)},te=()=>{const t={};Object.entries(v).forEach(([o,h])=>{h.forEach(w=>{const R=i(o,w);t[R]||(t[R]=[]),t[R].push({category:o,item:w})})});const s={};return["SSS","SS","S","Q","W","N"].forEach(o=>{t[o]&&t[o].length>0&&(s[o]=t[o])}),s};return e.jsx(Fe,{theme:it,children:e.jsxs(a,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[e.jsx(Pe,{position:"sticky",sx:{background:"#000",border:"2px solid #fff",borderStyle:"double",boxShadow:"none","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,background:"repeating-linear-gradient(0deg, #000 0px, #000 1px, transparent 1px, transparent 2px)",opacity:.1,pointerEvents:"none"}},children:e.jsx(se,{maxWidth:"lg",children:e.jsxs(Ne,{sx:{justifyContent:"space-between",alignItems:"center",padding:{xs:"8px 16px",md:"8px 24px"},minHeight:{xs:"56px",md:"64px"}},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,flex:"1 1 auto",justifyContent:"flex-start",height:"100%"},children:[e.jsx(q,{sx:{display:"flex"}}),e.jsx(n,{variant:"h5",sx:{fontFamily:'"Press Start 2P", cursive',fontWeight:"bold",color:"white",display:"flex",alignItems:"center",margin:0,padding:0,lineHeight:1,height:"100%",fontSize:"1rem",letterSpacing:"0.1em",textShadow:"2px 2px 0 #000, -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000"},children:"M-Profile Lab"})]}),e.jsxs(a,{sx:{display:{xs:"none",md:"flex"},gap:1,flex:"1 1 auto",justifyContent:"flex-end","& .MuiButton-root":{border:"2px solid #fff",fontSize:"0.7rem",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',fontWeight:600,minWidth:"auto",px:1.5,py:.5,"&:hover":{background:"#fff",color:"#000"}}},children:[e.jsx(d,{color:"inherit",startIcon:e.jsx(re,{}),href:"/index.html",children:"首页"}),e.jsx(d,{color:"inherit",startIcon:e.jsx(q,{}),href:"/s.html",children:"S版"}),e.jsx(d,{color:"inherit",href:"/female.html",startIcon:e.jsx(ce,{}),children:"女版"}),e.jsx(d,{color:"inherit",href:"/message.html",startIcon:e.jsx(ie,{}),children:"留言"}),e.jsx(d,{color:"inherit",startIcon:e.jsx(X,{}),onClick:()=>W(!0),sx:{maxWidth:"100px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:I().length>6?I().substring(0,6)+"...":I()})]}),e.jsx(ne,{color:"inherit",sx:{display:{xs:"block",md:"none"},border:"2px solid #fff",borderRadius:"4px",padding:"4px","&:hover":{background:"#fff",color:"#000"}},onClick:()=>S(!0),children:e.jsx(ze,{})})]})})}),e.jsx(He,{anchor:"right",open:pe,onClose:()=>S(!1),children:e.jsx(a,{sx:{width:250,pt:2},children:e.jsxs(Ue,{children:[e.jsxs(M,{button:!0,component:"a",href:"/index.html",onClick:()=>S(!1),children:[e.jsx(O,{children:e.jsx(re,{sx:{color:"#6200ea"}})}),e.jsx(A,{primary:"首页",sx:{color:"#6200ea"}})]}),e.jsxs(M,{button:!0,component:"a",href:"/s.html",onClick:()=>S(!1),children:[e.jsx(O,{children:e.jsx(q,{sx:{color:"#6200ea"}})}),e.jsx(A,{primary:"S版",sx:{color:"#6200ea"}})]}),e.jsxs(M,{button:!0,component:"a",href:"/female.html",onClick:()=>S(!1),children:[e.jsx(O,{children:e.jsx(ce,{sx:{color:"#6200ea"}})}),e.jsx(A,{primary:"女生版",sx:{color:"#6200ea"}})]}),e.jsxs(M,{button:!0,component:"a",href:"/message.html",onClick:()=>S(!1),children:[e.jsx(O,{children:e.jsx(ie,{sx:{color:"#6200ea"}})}),e.jsx(A,{primary:"留言板",sx:{color:"#6200ea"}})]}),e.jsxs(M,{button:!0,onClick:()=>{W(!0),S(!1)},children:[e.jsx(O,{children:e.jsx(X,{sx:{color:"#6200ea"}})}),e.jsx(A,{primary:"用户设置",sx:{color:"#6200ea"}})]})]})})}),e.jsxs(se,{maxWidth:"lg",sx:{py:8,minHeight:"100vh",display:"flex",flexDirection:"column",gap:5,animation:"fadeIn 0.6s ease-in-out","@keyframes fadeIn":{from:{opacity:0,transform:"translateY(20px)"},to:{opacity:1,transform:"translateY(0)"}}},children:[e.jsxs(a,{sx:{textAlign:"center",mb:4},children:[e.jsx(n,{variant:"h3",component:"h1",sx:{fontWeight:"bold",color:"black",cursor:"pointer",userSelect:"none","&:hover":{opacity:.8}},onDoubleClick:Re,title:"双击激活数据库诊断功能",children:"男M自评报告"}),e.jsxs(y,{elevation:1,sx:{mt:2,p:2,borderRadius:2,backgroundColor:"rgba(255, 255, 255, 0.9)",maxWidth:{xs:"100%",md:"80%"},mx:"auto"},children:[e.jsx(n,{variant:"subtitle2",sx:{fontWeight:"bold",mb:1,color:"#000000",textAlign:"center"},children:"评分等级说明"}),e.jsxs(a,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:{xs:1,md:2}},children:[e.jsxs(n,{variant:"body2",sx:{fontSize:"0.9rem"},children:[e.jsx(a,{component:"span",sx:{fontWeight:"bold",color:"#FF1493"},children:"SSS"})," = 非常喜欢"]}),e.jsxs(n,{variant:"body2",sx:{fontSize:"0.9rem"},children:[e.jsx(a,{component:"span",sx:{fontWeight:"bold",color:"#FF69B4"},children:"SS"})," = 喜欢"]}),e.jsxs(n,{variant:"body2",sx:{fontSize:"0.9rem"},children:[e.jsx(a,{component:"span",sx:{fontWeight:"bold",color:"#87CEEB"},children:"S"})," = 接受"]}),e.jsxs(n,{variant:"body2",sx:{fontSize:"0.9rem"},children:[e.jsx(a,{component:"span",sx:{fontWeight:"bold",color:"#FFD700"},children:"Q"})," = 不喜欢但会做"]}),e.jsxs(n,{variant:"body2",sx:{fontSize:"0.9rem"},children:[e.jsx(a,{component:"span",sx:{fontWeight:"bold",color:"#FF4500"},children:"N"})," = 拒绝"]}),e.jsxs(n,{variant:"body2",sx:{fontSize:"0.9rem"},children:[e.jsx(a,{component:"span",sx:{fontWeight:"bold",color:"#808080"},children:"W"})," = 未知"]})]})]}),e.jsxs(a,{sx:{mt:3,textAlign:"center",display:"flex",flexDirection:"column",gap:2,alignItems:"center"},children:[e.jsxs(a,{sx:{display:"flex",gap:2,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[e.jsx(K,{label:`已完成: ${Object.values(g).filter(t=>t!=="").length}/${Object.keys(v).reduce((t,s)=>t+v[s].length,0)}`,color:"primary",variant:"outlined"}),ye&&e.jsx(K,{label:"有未保存的更改",color:"warning",variant:"filled",icon:e.jsx(oe,{})}),e.jsx(K,{label:`用户: ${Ye()}`,color:"secondary",variant:"outlined",icon:e.jsx(X,{})})]}),e.jsxs(a,{sx:{display:"flex",gap:2,flexWrap:"wrap",justifyContent:"center"},children:[e.jsx(d,{variant:"contained",size:"large",startIcon:e.jsx(oe,{}),disabled:j||Object.keys(g).length===0,className:"pixel-button",sx:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',fontWeight:600},onClick:we,children:j?"保存中...":"保存测试"}),e.jsx(d,{variant:"outlined",size:"large",startIcon:e.jsx(qe,{}),onClick:()=>T(!0),className:"pixel-button",sx:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',fontWeight:600},children:"查看记录"}),e.jsx(d,{variant:"outlined",size:"large",startIcon:e.jsx(Xe,{}),className:"pixel-button",sx:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',fontWeight:600},onClick:()=>{const t={};Object.entries(v).forEach(([s,r])=>{r.forEach(o=>{const h=Math.floor(Math.random()*H.length);t[`${s}-${o}`]=H[h]})}),C(t),c("已完成随机选择！"),l(!0)},children:"随机选择"}),e.jsx(d,{variant:"outlined",size:"large",startIcon:e.jsx(le,{}),color:"error",className:"pixel-button",sx:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',fontWeight:600},onClick:Me,children:"清空测试"}),Se&&e.jsx(d,{variant:"outlined",size:"large",startIcon:e.jsx(ot,{}),color:"info",className:"pixel-button",sx:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',fontWeight:600},onClick:Z,disabled:j,children:"数据库诊断"})]})]})]}),Object.entries(v).map(([t,s])=>e.jsxs(y,{elevation:2,sx:{p:{xs:3,md:4},borderRadius:3,backgroundColor:"background.paper",transition:"all 0.3s ease","&:hover":{transform:"translateY(-4px)",boxShadow:"0 12px 24px rgba(0,0,0,0.1)"}},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(n,{variant:"h5",sx:{mb:0,color:"black"},children:t}),e.jsxs(ae,{size:"small",value:me,onChange:r=>{Te(t,r.target.value),ue("")},displayEmpty:!0,placeholder:"一键选择",renderValue:r=>r||"一键选择",sx:{minWidth:120},children:[e.jsx(z,{value:"",children:e.jsx("em",{children:"一键选择"})}),H.map(r=>e.jsx(z,{value:r,children:r},r))]})]}),e.jsx(f,{container:!0,spacing:2,sx:{mt:0,width:"100%",margin:0},children:s.map(r=>e.jsx(f,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:{xs:1,md:1.5},borderRadius:2,height:"100%",backgroundColor:i(t,r)?`${p(i(t,r))}20`:"background.paper",boxShadow:i(t,r)?`0 1px 4px ${p(i(t,r))}60`:"0 1px 3px rgba(0,0,0,0.1)",borderLeft:i(t,r)?`3px solid ${p(i(t,r))}`:"none",transition:"all 0.3s ease",gap:1,"&:hover":{backgroundColor:i(t,r)?`${p(i(t,r))}30`:"rgba(98, 0, 234, 0.04)",transform:"translateX(4px)",boxShadow:i(t,r)?`0 2px 8px ${p(i(t,r))}80`:"0 2px 6px rgba(0,0,0,0.15)"}},children:[e.jsx(a,{sx:{display:"flex",alignItems:"center",flexGrow:1,minWidth:0},children:e.jsx(n,{sx:{fontWeight:500,color:i(t,r)?`${p(i(t,r))}`:"text.primary",fontSize:{xs:"0.85rem",md:"1rem"},overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",transition:"color 0.3s ease"},children:r})}),e.jsxs(ae,{size:"small",value:i(t,r),onChange:o=>Oe(t,r,o.target.value),sx:{minWidth:{xs:100,md:120},".MuiSelect-select":{py:1.5,px:2,color:i(t,r)?p(i(t,r)):"inherit"},"& .MuiOutlinedInput-notchedOutline":{borderColor:i(t,r)?`${p(i(t,r))}80`:"rgba(0, 0, 0, 0.23)",transition:"border-color 0.3s ease"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:i(t,r)?p(i(t,r)):"rgba(0, 0, 0, 0.23)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:i(t,r)?p(i(t,r)):"primary.main"}},children:[e.jsx(z,{value:"",children:e.jsx("em",{children:"请选择"})}),H.map(o=>e.jsx(z,{value:o,children:o},o))]})]})},r))})]},t)),e.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mt:4,gap:4},children:[e.jsx(d,{variant:"contained",color:"primary",size:"large",onClick:()=>U(!0),className:"pixel-button",sx:{minWidth:200},children:"生成报告"}),e.jsxs(y,{elevation:2,sx:{p:3,borderRadius:2,textAlign:"center",maxWidth:300,mx:"auto",backgroundColor:"white"},children:[e.jsx(n,{variant:"subtitle1",sx:{fontWeight:"bold",color:"primary.main",mb:2},children:"扫码领取您的XP报告"}),e.jsx(a,{component:"img",src:"/qrcode.png",alt:"QR Code",sx:{width:"200px",height:"200px",display:"block",margin:"0 auto"}})]})]}),e.jsxs(E,{open:de,onClose:()=>U(!1),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:{xs:"95vh",md:"auto"},maxHeight:{xs:"95vh",md:"90vh"},overflowY:"auto",m:{xs:1,sm:2},width:"100%",maxWidth:{sm:"800px"},mx:"auto",backgroundColor:"#fafafa","@media print":{height:"auto",maxHeight:"none",overflow:"visible"}}},children:[e.jsx(F,{sx:{textAlign:"center",fontWeight:"bold",pt:{xs:4,md:5},mt:{xs:2,md:3},color:"black",borderBottom:"2px solid #6200ea",mb:2},children:"男M自评详细报告"}),e.jsx(P,{ref:k,sx:{px:4,py:3,display:"flex",flexDirection:"column",gap:4,"@media print":{overflow:"visible",height:"auto"}},children:e.jsxs(a,{ref:k,sx:{p:3},children:[e.jsx(n,{variant:"h4",gutterBottom:!0,align:"center",sx:{color:"#1E3D59",mb:4},children:"男M自评报告"}),e.jsx(a,{sx:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"400px",mb:4},children:e.jsxs(Ke,{width:600,height:400,data:ee(),style:{margin:"0 auto"},children:[e.jsx(Ve,{}),e.jsx(Je,{dataKey:"category"}),e.jsx(Ze,{angle:30,domain:[0,6]}),e.jsx(et,{name:"得分",dataKey:"value",stroke:"#1E3D59",fill:"#1E3D59",fillOpacity:.6})]})}),Object.entries(te()).map(([t,s])=>s.length===0?null:e.jsxs(a,{sx:{mb:4},children:[e.jsxs(n,{variant:"h5",sx:{color:p(t),borderBottom:`2px solid ${p(t)}`,pb:1,mb:2},children:[t,"级 (",s.length,"项)"]}),e.jsx(f,{container:!0,spacing:2,children:s.map(({category:r,item:o},h)=>e.jsx(f,{item:!0,xs:12,sm:6,md:4,children:e.jsx(y,{elevation:3,sx:{p:2,display:"flex",alignItems:"center",backgroundColor:`${p(t)}22`},children:e.jsxs(n,{children:[e.jsxs("strong",{children:[r,":"]})," ",o]})})},`${r}-${o}-${h}`))})]},t)),e.jsxs(a,{sx:{mt:6,display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",p:3,border:"2px solid #1E3D59",borderRadius:2,backgroundColor:"#ffffff"},children:[e.jsx(n,{variant:"h6",sx:{mb:2,color:"#1E3D59"},children:"原生相机扫码领取您的XP报告"}),e.jsx(a,{component:"img",src:"/qrcode.png",alt:"QR Code",sx:{width:200,height:200,display:"block"}})]})]})}),e.jsxs(N,{sx:{justifyContent:"center",pb:3,pt:2,gap:2,borderTop:"1px solid rgba(0,0,0,0.1)",backgroundColor:"white"},children:[e.jsx(d,{onClick:Ae,variant:"contained",color:"primary",children:"保存为图片"}),e.jsx(d,{onClick:$e,variant:"contained",color:"secondary",children:"保存为PDF"})]}),e.jsx(ne,{onClick:()=>U(!1),sx:{position:"absolute",right:8,top:8,color:"rgba(0, 0, 0, 0.54)"},children:e.jsx(le,{})})]}),e.jsxs(E,{open:fe,onClose:()=>T(!1),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:{xs:"80vh",md:"60vh"},maxHeight:{xs:"90vh",md:"80vh"}}},children:[e.jsx(F,{sx:{textAlign:"center",fontWeight:"bold",borderBottom:"2px dashed #6200ea",mb:2},children:"测试历史记录"}),e.jsx(P,{sx:{px:3,py:2},children:j?e.jsx(a,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(n,{children:"加载中..."})}):B.length===0?e.jsxs(a,{sx:{textAlign:"center",py:4},children:[e.jsx(n,{variant:"h6",color:"text.secondary",children:"暂无测试记录"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"完成测试并保存后，记录将显示在这里"})]}):e.jsx(f,{container:!0,spacing:2,children:B.map((t,s)=>{var r,o;return e.jsx(f,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(y,{elevation:2,sx:{p:2,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(n,{variant:"h6",sx:{mb:1,color:"#6200ea"},children:["测试 #",B.length-s]}),e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["时间: ",new Date(t.created_at).toLocaleString("zh-CN")]}),e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["完成度: ",((r=t.report_data)==null?void 0:r.completedItems)||0,"/",((o=t.report_data)==null?void 0:o.totalItems)||0]}),e.jsxs(a,{sx:{mt:"auto",display:"flex",gap:1},children:[e.jsx(d,{size:"small",variant:"contained",onClick:()=>Ie(t.id),disabled:j,sx:{flex:1},children:"加载"}),e.jsx(d,{size:"small",variant:"outlined",color:"error",onClick:()=>We(t.id),disabled:j,children:"删除"})]})]})},t.id)})})}),e.jsx(N,{sx:{justifyContent:"center",pb:2},children:e.jsx(d,{onClick:()=>T(!1),children:"关闭"})})]}),e.jsxs(E,{open:ge,onClose:()=>W(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(F,{sx:{textAlign:"center",fontWeight:"bold",borderBottom:"2px dashed #6200ea",mb:2},children:"用户设置"}),e.jsx(P,{sx:{px:3,py:2},children:e.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsx(_e,{label:"用户昵称",value:V,onChange:t=>je(t.target.value),fullWidth:!0,helperText:"设置一个好记的昵称，方便识别您的测试记录",variant:"outlined"}),e.jsxs(a,{sx:{p:2,bgcolor:"grey.50",borderRadius:1},children:[e.jsx(n,{variant:"subtitle2",sx:{mb:1,fontWeight:"bold"},children:"用户信息"}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:["用户ID: ",$()]}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:["当前昵称: ",I()]}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:["测试记录数: ",B.length]})]})]})}),e.jsxs(N,{sx:{justifyContent:"center",pb:2,gap:2},children:[e.jsx(d,{onClick:De,variant:"contained",children:"保存昵称"}),e.jsx(d,{onClick:()=>W(!1),children:"取消"})]})]}),e.jsxs(E,{open:ve,onClose:()=>L(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(F,{sx:{textAlign:"center",fontWeight:"bold",borderBottom:"2px dashed #6200ea",mb:2},children:"数据库诊断报告"}),e.jsx(P,{sx:{px:3,py:2},children:j?e.jsx(a,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(n,{children:"正在诊断数据库..."})}):u?e.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(y,{elevation:1,sx:{p:2,bgcolor:"grey.50"},children:[e.jsx(n,{variant:"h6",sx:{mb:2,color:"#6200ea"},children:"诊断摘要"}),e.jsxs(f,{container:!0,spacing:2,children:[e.jsxs(f,{item:!0,xs:6,sm:3,children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"数据库连接"}),e.jsx(n,{variant:"body1",children:u.summary.connection})]}),e.jsxs(f,{item:!0,xs:6,sm:3,children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"数据表"}),e.jsxs(n,{variant:"body1",children:[u.summary.tablesCount,"/",u.summary.totalTables]})]}),e.jsxs(f,{item:!0,xs:6,sm:3,children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"错误数量"}),e.jsx(n,{variant:"body1",color:u.summary.errorsCount>0?"error":"success.main",children:u.summary.errorsCount})]})]})]}),u.details.errors.length>0&&e.jsxs(y,{elevation:1,sx:{p:2,bgcolor:"#ffebee"},children:[e.jsx(n,{variant:"h6",sx:{mb:2,color:"error.main"},children:"发现的问题"}),u.details.errors.map((t,s)=>e.jsxs(n,{variant:"body2",sx:{mb:1,color:"error.dark"},children:["• ",t]},s))]}),e.jsxs(y,{elevation:1,sx:{p:2,bgcolor:"#e8f5e8"},children:[e.jsx(n,{variant:"h6",sx:{mb:2,color:"success.main"},children:"修复建议"}),u.recommendations.map((t,s)=>e.jsxs(n,{variant:"body2",sx:{mb:1},children:[s+1,". ",t]},s))]})]}):e.jsx(a,{sx:{textAlign:"center",py:4},children:e.jsx(n,{variant:"h6",color:"text.secondary",children:'点击"开始诊断"检查数据库状态'})})}),e.jsxs(N,{sx:{justifyContent:"center",pb:2,gap:2},children:[!u&&e.jsx(d,{onClick:Z,variant:"contained",disabled:j,children:j?"诊断中...":"开始诊断"}),e.jsx(d,{onClick:()=>{L(!1),J(null)},children:"关闭"})]})]}),e.jsx(Le,{open:xe,autoHideDuration:3e3,onClose:()=>l(!1),message:he,anchorOrigin:{vertical:"bottom",horizontal:"center"}})]}),e.jsx(tt,{pixelStyle:!0})]})})}Ge.createRoot(document.getElementById("root")).render(e.jsx(Qe.StrictMode,{children:e.jsx(lt,{})}));
