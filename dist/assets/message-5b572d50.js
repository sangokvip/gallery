import{a1 as S,a2 as w,j as e,c as Le,R as ge,B as f,b as p,e as y,r as c,a5 as v,a3 as de,T as Pe,A as Be,C as xe,a as Ne,d as Y,f as ue,I as C,g as We,D as Ue,L as qe,h as M,i as D,k as $,P as q,p as G,l as Fe,m as Ve,n as Ze,o as Ae,q as Ye,s as Ge}from"./v4-74551561.js";import{d as pe,D as Je,C as he,a as me,b as Ke,c as je}from"./Edit-bec97425.js";import{d as Qe}from"./Female-84d5811b.js";import{d as Xe}from"./Male-954eee75.js";/* empty css              */var K={},er=w;Object.defineProperty(K,"__esModule",{value:!0});var ve=K.default=void 0,rr=er(S()),or=e;ve=K.default=(0,rr.default)((0,or.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");var Q={},tr=w;Object.defineProperty(Q,"__esModule",{value:!0});var X=Q.default=void 0,sr=tr(S()),lr=e;X=Q.default=(0,sr.default)((0,lr.jsx)("path",{d:"M9 21h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.58 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2M9 9l4.34-4.34L12 10h9v2l-3 7H9zM1 9h4v12H1z"}),"ThumbUpOutlined");var ee={},ar=w;Object.defineProperty(ee,"__esModule",{value:!0});var re=ee.default=void 0,nr=ar(S()),ir=e;re=ee.default=(0,nr.default)((0,ir.jsx)("path",{d:"M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2m0 12-4.34 4.34L12 14H3v-2l3-7h9zm4-12h4v12h-4z"}),"ThumbDownOutlined");var oe={},cr=w;Object.defineProperty(oe,"__esModule",{value:!0});var ye=oe.default=void 0,fr=cr(S()),dr=e;ye=oe.default=(0,fr.default)((0,dr.jsx)("path",{d:"M19 5h-2V3H7v2H5c-1.1 0-2 .9-2 2v1c0 2.55 1.92 4.63 4.39 4.94.63 1.5 1.98 2.63 3.61 2.96V19H7v2h10v-2h-4v-3.1c1.63-.33 2.98-1.46 3.61-2.96C19.08 12.63 21 10.55 21 8V7c0-1.1-.9-2-2-2M5 8V7h2v3.82C5.84 10.4 5 9.3 5 8m14 0c0 1.3-.84 2.4-2 2.82V7h2z"}),"EmojiEvents");var te={},xr=w;Object.defineProperty(te,"__esModule",{value:!0});var ke=te.default=void 0,ur=xr(S()),pr=e;ke=te.default=(0,ur.default)((0,pr.jsx)("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H6l-2 2V4h16z"}),"ChatBubbleOutline");var se={},hr=w;Object.defineProperty(se,"__esModule",{value:!0});var Ce=se.default=void 0,mr=hr(S()),br=e;Ce=se.default=(0,mr.default)((0,br.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");var le={},gr=w;Object.defineProperty(le,"__esModule",{value:!0});var _e=le.default=void 0,jr=gr(S()),vr=e;_e=le.default=(0,jr.default)((0,vr.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess");var ae={},yr=w;Object.defineProperty(ae,"__esModule",{value:!0});var J=ae.default=void 0,kr=yr(S()),Cr=e;J=ae.default=(0,kr.default)((0,Cr.jsx)("path",{d:"M22 16V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2m-11-4 2.03 2.71L16 11l4 5H8zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6z"}),"Collections");const _r=Le({palette:{primary:{main:"#ff69b4",light:"#ff8dc3",dark:"#c13b86"},secondary:{main:"#4a148c",light:"#7c43bd",dark:"#12005e"},background:{default:"#fce4ec",paper:"#ffffff"}},typography:{fontFamily:"inherit",h3:{fontFamily:'"Press Start 2P", cursive',fontWeight:700,color:"#ff69b4",textShadow:"2px 2px 0 #4a148c",textAlign:"center",marginBottom:"2rem"}},components:{MuiPaper:{styleOverrides:{root:{borderRadius:"12px",border:"4px solid #ff69b4",boxShadow:"4px 4px 0 rgba(74, 20, 140, 0.5)",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)"}}}},MuiButton:{styleOverrides:{root:{fontFamily:"inherit",border:"3px solid #ff69b4",boxShadow:"3px 3px 0 rgba(74, 20, 140, 0.5)","&:hover":{transform:"translate(-2px, -2px)",boxShadow:"5px 5px 0 rgba(74, 20, 140, 0.5)"},"&:active":{transform:"translate(2px, 2px)",boxShadow:"1px 1px 0 rgba(74, 20, 140, 0.5)"}}}}}}),be=m=>{const x=/1[3-9]\d{9}/g,k=new RegExp("(?<![a-zA-Z0-9])[a-zA-Z][a-zA-Z0-9_-]{5,19}","g"),j=new RegExp("(?<!\\d)[1-9][0-9]{4,10}(?!\\d)","g"),d=/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,I=["王晓然","wangxiaoran","wang xiaoran","王晓玥","wangxiaoyue","wang xiaoyue","SOAP","soap","Soap","女装","nvzhuang","nu zhuang","塔罗牌","taluopai","taluo pai","tarot","宏程","hongcheng","hong cheng","王老师","wanglaoshi","wang laoshi"];let n=m;return n=n.replace(x,l=>"*".repeat(l.length)),n=n.replace(k,l=>"*".repeat(l.length)),n=n.replace(j,l=>"*".repeat(l.length)),n=n.replace(d,l=>"*".repeat(l.length)),I.forEach(l=>{const T=new RegExp(l,"gi");n=n.replace(T,a=>"*".repeat(a.length))}),n},Sr=({reply:m,onDelete:x,isOwner:k,isAdminMessage:j})=>e.jsxs(q,{sx:{p:{xs:1,sm:1.5},ml:{xs:2,sm:3},mb:1,backgroundColor:j?"#4a148c":"#fff0f5",border:`2px solid ${j?"#7c43bd":"#ff69b4"}`,boxShadow:"2px 2px 0 rgba(255, 105, 180, 0.3)",position:"relative","&::before":{content:'""',position:"absolute",left:"-10px",top:"10px",width:"0",height:"0",borderTop:"6px solid transparent",borderBottom:"6px solid transparent",borderRight:`10px solid ${j?"#4a148c":"#ff69b4"}`}},children:[e.jsx(p,{variant:"body2",sx:{wordBreak:"break-word",color:j?"#ffffff":"inherit",fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:m.text}),k&&e.jsx(C,{onClick:x,size:"small",sx:{position:"absolute",right:4,top:4,padding:.5,color:j?"#ffffff":"#ff69b4","&:hover":{color:"#ff8dc3"}},children:e.jsx(je,{sx:{fontSize:"0.875rem"}})})]}),wr=({message:m,originalText:x,onDelete:k,isOwner:j,isAdminMessage:d,onReact:I,reactions:n,isPinned:l,onTogglePin:T,isAdmin:a,onReply:h,replies:R=[],onDeleteReply:i,currentUserId:P,onEditReactions:F,messageUserId:V})=>{const[E,B]=c.useState(!1),[O,H]=c.useState(""),[u,L]=c.useState(!1),N=b=>{b.preventDefault(),O.trim()&&(h(O.trim()),H(""),L(!1))};return e.jsxs(q,{sx:{p:2,width:"100%",boxSizing:"border-box",margin:0,position:"relative",animation:l?"float 3s ease-in-out infinite":"none",...V===P&&!d&&{border:"4px solid #ff69b4",boxShadow:"0 4px 12px rgba(255, 105, 180, 0.3)",backgroundColor:"rgba(255, 192, 203, 0.1)","&:before":{content:'"我的留言"',position:"absolute",top:-10,left:10,backgroundColor:"#ff69b4",color:"white",padding:"2px 8px",borderRadius:"4px",fontSize:"0.75rem",zIndex:1},"&:hover":{transform:"translateY(-4px)",boxShadow:"0 6px 16px rgba(255, 105, 180, 0.4)",transition:"all 0.3s ease"}},...d&&{backgroundColor:"#4a148c !important",border:"4px solid #7c43bd",boxShadow:"4px 4px 0 rgba(255, 105, 180, 0.5)","& .MuiTypography-root:not(.reaction-count)":{color:"#ff8dc3",fontWeight:"bold",position:"relative"}},...l&&{border:"2px solid #ff69b4","&::before":{content:'"📌"',position:"absolute",top:"-10px",right:"-10px",fontSize:"20px",transform:"rotate(45deg)"}}},className:"pixel-theme-pink",children:[e.jsxs(f,{sx:{flex:1},children:[e.jsx(p,{variant:"body1",sx:{wordBreak:"break-word",fontSize:{xs:"0.875rem",sm:"1rem"}},children:m}),d&&x!==m&&e.jsxs(p,{variant:"caption",sx:{display:"block",mt:1,color:"#ff69b4",fontStyle:"italic",fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:["原文: ",x]})]}),e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:{xs:1.5,sm:2},pt:{xs:1,sm:1},borderTop:"1px solid rgba(0,0,0,0.1)"},children:[e.jsxs(f,{sx:{display:"flex",gap:{xs:1,sm:2}},children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(C,{size:"small",onClick:()=>I(!0),sx:{color:"#ff69b4",padding:{xs:.5,sm:1},"&:hover":{color:"#ff8dc3",transform:"scale(1.1)"},transition:"transform 0.2s ease, color 0.2s ease",...d&&{color:"#ffffff","&:hover":{color:"#ff8dc3",transform:"scale(1.1)"}}},title:"点赞",children:e.jsx(X,{sx:{fontSize:{xs:"1rem",sm:"1.25rem"}}})}),e.jsx(p,{variant:"caption",className:"reaction-count",sx:{ml:.5,color:d?"#ffffff":"#ff69b4",fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:(n==null?void 0:n.likes)||0}),a&&e.jsx(C,{size:"small",onClick:()=>F(messageId,"likes",(n==null?void 0:n.likes)||0),sx:{color:d?"#ffffff":"#ff69b4",padding:{xs:.2,sm:.5},ml:.5,"&:hover":{color:"#ff8dc3",transform:"scale(1.1)"}},title:"修改点赞数",children:e.jsx(me,{sx:{fontSize:{xs:"0.75rem",sm:"1rem"}}})})]}),e.jsxs(f,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(C,{size:"small",onClick:()=>I(!1),sx:{color:"#ff69b4",padding:{xs:.5,sm:1},"&:hover":{color:"#ff8dc3",transform:"scale(1.1)"},transition:"transform 0.2s ease, color 0.2s ease",...d&&{color:"#ffffff","&:hover":{color:"#ff8dc3",transform:"scale(1.1)"}}},title:"点踩",children:e.jsx(re,{sx:{fontSize:{xs:"1rem",sm:"1.25rem"}}})}),e.jsx(p,{variant:"caption",className:"reaction-count",sx:{ml:.5,color:d?"#ffffff":"#ff69b4",fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:(n==null?void 0:n.dislikes)||0}),a&&e.jsx(C,{size:"small",onClick:()=>F(messageId,"dislikes",(n==null?void 0:n.dislikes)||0),sx:{color:d?"#ffffff":"#ff69b4",padding:{xs:.2,sm:.5},ml:.5,"&:hover":{color:"#ff8dc3",transform:"scale(1.1)"}},title:"修改点踩数",children:e.jsx(me,{sx:{fontSize:{xs:"0.75rem",sm:"1rem"}}})})]}),e.jsxs(C,{size:"small",onClick:()=>L(!u),sx:{color:"#ff69b4",padding:{xs:.5,sm:1},"&:hover":{color:"#ff8dc3",transform:"scale(1.1)"},transition:"transform 0.2s ease, color 0.2s ease",...d&&{color:"#ffffff","&:hover":{color:"#ff8dc3",transform:"scale(1.1)"}}},title:"回复",children:[e.jsx(ke,{sx:{fontSize:{xs:"1rem",sm:"1.25rem"}}}),e.jsx(p,{variant:"caption",className:"reaction-count",sx:{ml:.5,color:d?"#ffffff":"#ff69b4",fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:R.length})]})]}),e.jsxs(f,{sx:{display:"flex",gap:{xs:.5,sm:1}},children:[R.length>0&&e.jsx(C,{size:"small",onClick:()=>B(!E),sx:{padding:{xs:.5,sm:1},color:d?"#ffffff":"#ff69b4","&:hover":{color:"#ff8dc3"}},children:E?e.jsx(_e,{sx:{fontSize:{xs:"1rem",sm:"1.25rem"}}}):e.jsx(Ce,{sx:{fontSize:{xs:"1rem",sm:"1.25rem"}}})}),a&&!d&&e.jsx(C,{size:"small",onClick:()=>T(!l),sx:{padding:{xs:.5,sm:1},color:l?"#ff69b4":"inherit","&:hover":{color:"#ff69b4"}},children:e.jsx(Ke,{sx:{fontSize:{xs:"1rem",sm:"1.25rem"},transform:l?"rotate(45deg)":"none",transition:"transform 0.3s ease"}})}),j&&e.jsx(C,{onClick:k,size:"small",sx:{padding:{xs:.5,sm:1},color:d?"#ffffff":"#ff69b4","&:hover":{color:d?"#ff69b4":"#ff8dc3",transform:"scale(1.1)"}},children:e.jsx(je,{sx:{fontSize:{xs:"1rem",sm:"1.25rem"}}})})]})]}),u&&e.jsxs(f,{component:"form",onSubmit:N,sx:{mt:2,display:"flex",gap:1,borderTop:"1px solid rgba(0,0,0,0.1)",pt:2},children:[e.jsx(G,{size:"small",fullWidth:!0,value:O,onChange:b=>H(b.target.value),placeholder:"回复...",variant:"outlined",sx:{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#ff69b4",borderWidth:"2px"},"&:hover fieldset":{borderColor:"#ff69b4"},"&.Mui-focused fieldset":{borderColor:"#ff69b4"}}}}),e.jsx(y,{type:"submit",variant:"contained",size:"small",sx:{minWidth:"unset",backgroundColor:"#ff69b4",color:"white","&:hover":{backgroundColor:"#ff8dc3"}},children:"发送"})]}),E&&R.length>0&&e.jsx(f,{sx:{mt:2},children:R.map(b=>e.jsx(Sr,{reply:b,onDelete:()=>i(b.id),isOwner:a||b.user_id===P,isAdminMessage:b.is_admin},b.id))})]})},Ir=({messages:m})=>e.jsxs(q,{sx:{p:2,width:"100%",boxSizing:"border-box",margin:0,"& > *:last-child":{marginBottom:0}},className:"pixel-theme-pink",elevation:0,children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(ye,{sx:{color:"#ff69b4",mr:1}}),e.jsx(p,{variant:"h6",sx:{color:"#ff69b4"},children:"热门留言榜"})]}),e.jsx(Je,{sx:{mb:2}}),e.jsxs(f,{sx:{display:"flex",flexDirection:"column",gap:2},children:[m.map((x,k)=>e.jsxs(f,{sx:{p:1.5,borderRadius:1,backgroundColor:"rgba(255, 105, 180, 0.1)",border:"2px solid rgba(255, 105, 180, 0.2)",position:"relative","&:hover":{backgroundColor:"rgba(255, 105, 180, 0.15)"}},children:[e.jsx(f,{sx:{position:"absolute",top:-10,left:-10,width:24,height:24,borderRadius:"50%",backgroundColor:"#ff69b4",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"0.8rem",fontWeight:"bold",border:"2px solid white",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:k+1}),e.jsxs(p,{variant:"subtitle2",sx:{color:"#ff69b4",mb:.5,display:"flex",alignItems:"center",gap:1},children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(X,{sx:{fontSize:16}}),x.likes||0]}),e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(re,{sx:{fontSize:16}}),x.dislikes||0]})]}),e.jsx(p,{variant:"body2",sx:{color:"text.secondary",...x.user_id==="admin"&&{color:"#4a148c",fontWeight:"bold"}},children:x.text})]},x.id)),m.length===0&&e.jsx(p,{variant:"body2",sx:{color:"text.secondary",textAlign:"center",py:2},children:"暂无热门留言"})]})]});class Rr extends ge.Component{constructor(x){super(x),this.state={hasError:!1,error:null}}static getDerivedStateFromError(x){return{hasError:!0,error:x}}componentDidCatch(x,k){console.error("MessageApp错误:",x,k)}render(){return this.state.hasError?e.jsxs(f,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",backgroundColor:"#fce4ec",padding:3},children:[e.jsx(p,{variant:"h6",sx:{color:"#ff69b4",marginBottom:2},children:"页面加载出错了"}),e.jsx(y,{variant:"contained",onClick:()=>window.location.reload(),sx:{backgroundColor:"#ff69b4","&:hover":{backgroundColor:"#ff8dc3"}},children:"刷新页面"})]}):this.props.children}}function zr(){const[m,x]=c.useState([]),[k,j]=c.useState([]),[d,I]=c.useState(""),[n,l]=c.useState(!1),[T,a]=c.useState(""),[h,R]=c.useState(!1),[i,P]=c.useState(null),[F,V]=c.useState({}),[E,B]=c.useState({}),[O,H]=c.useState(!0),[u,L]=c.useState(!1),[N,b]=c.useState(null),[Z,Se]=c.useState(!1),[_,W]=c.useState({open:!1,messageId:null,type:"likes",count:0}),[ne,ie]=c.useState(0),[we,ce]=c.useState(!1);c.useEffect(()=>(console.log("组件挂载"),L(!0),()=>{console.log("组件卸载"),L(!1)}),[]);const U=c.useCallback(async r=>{if(!i||!u){console.log("跳过获取回复：",{messageId:r,userId:!!i,isMounted:u});return}try{console.log("开始获取消息回复:",r);const t=await v.getMessageReplies(r);if(!u){console.log("组件已卸载，取消更新回复状态");return}console.log("成功获取回复:",r,(t==null?void 0:t.length)||0,"条"),B(o=>({...o,[r]:t||[]}))}catch(t){if(!u)return;console.error("获取回复失败:",r,t),B(o=>({...o,[r]:[]}))}},[i,u]),z=c.useCallback(async()=>{if(!i||!u){console.log("跳过获取消息：",{userId:!!i,isMounted:u});return}try{b(null),H(!0),console.log("开始获取消息列表...");const r=await v.getMessages();if(!u){console.log("组件已卸载，取消更新消息状态");return}if(console.log("获取到消息数据:",(r==null?void 0:r.length)||0,"条"),Array.isArray(r)){const t=r.sort((o,s)=>{if(o.is_pinned&&!s.is_pinned)return-1;if(!o.is_pinned&&s.is_pinned)return 1;if(o.is_pinned===s.is_pinned){if(o.user_id==="admin"&&s.user_id!=="admin")return-1;if(o.user_id!=="admin"&&s.user_id==="admin")return 1;if(o.user_id===i&&s.user_id!==i&&s.user_id!=="admin")return-1;if(o.user_id!==i&&s.user_id===i&&o.user_id!=="admin")return 1}return new Date(s.created_at)-new Date(o.created_at)});x(t),t.forEach(o=>{console.log("准备获取消息回复:",o.id),U(o.id)})}else console.warn("获取到的消息数据格式不正确:",r),x([])}catch(r){if(!u)return;console.error("获取消息失败:",r),b(r.message||"加载留言失败，请检查网络连接"),a(`加载留言失败：${r.message||"请检查网络连接"}`),l(!0),x([])}finally{u&&H(!1)}},[i,u,U]),A=c.useCallback(async()=>{if(!i||!u){console.log("跳过获取热门消息：",{userId:!!i,isMounted:u});return}try{console.log("开始获取热门消息...");const r=await v.getTopMessages();if(!u){console.log("组件已卸载，取消更新热门消息状态");return}console.log("获取到热门消息:",(r==null?void 0:r.length)||0,"条"),j(r||[])}catch(r){if(!u){console.log("组件已卸载，取消更新热门消息错误状态");return}console.error("获取热门消息失败:",r),j([])}},[i,u]);c.useCallback(async r=>{try{const t=await v.getMessageReactions(r);V(o=>({...o,[r]:t}))}catch(t){console.error("获取消息反应失败:",t)}},[]),c.useEffect(()=>{var r;try{console.log("开始初始化用户ID...");let t=(r=document.cookie.match(/userId=([^;]+)/))==null?void 0:r[1],o;const s=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/;if(t){let g=t;g.startsWith("user_")&&(console.log("移除 'user_' 前缀:",g),g=g.substring(5)),s.test(g)?(o=g,console.log("使用cookie中的有效UUID:",o)):(console.log("Cookie中的UUID格式无效，生成新的UUID"),o=de())}else console.log("Cookie中未找到UUID，生成新的UUID"),o=de();document.cookie=`userId=${o};path=/;max-age=31536000;SameSite=Lax`,console.log("设置用户ID:",o),P(o),Se(!0)}catch(t){console.error("初始化用户ID失败:",t),b("初始化用户ID失败，请刷新页面重试")}},[]),c.useEffect(()=>{i&&u&&Z&&(console.log("用户ID已设置，开始加载消息"),z(),A())},[i,u,Z,z,A]);const Ie=async r=>{if(r.preventDefault(),d.trim()){if(d.trim().length>200){a("留言不能超过200字"),l(!0);return}if(!h)try{if(await v.countUserMessagesInLast24Hours(i)>=6){a("您今天留言已达上限（6条）"),l(!0);return}}catch(s){console.error("Error checking message limit:",s),a("检查留言频率时出错，请稍后再试"),l(!0);return}const o={text:h?d.trim():be(d.trim()),userId:h?"admin":i,originalText:d.trim()};try{await v.createMessage(o)?(await z(),I(""),a("留言成功！"),l(!0)):(a("留言似乎成功，但服务器未返回确认信息"),l(!0))}catch(s){if(console.error("详细错误信息:",s),s.message.includes("相同的留言"))a("您已经发送过相同的留言了");else{const g=(s==null?void 0:s.details)||(s==null?void 0:s.message)||(s==null?void 0:s.error_description)||"未知错误";a(`留言失败：${g}`)}l(!0)}}},Re=()=>{const r=prompt("请输入管理员密码：");r==="Sangok#3"?(R(!0),a("管理员登录成功！"),l(!0)):r!==null&&(a("密码错误！"),l(!0))},ze=async(r,t)=>{try{await v.addReaction(r,i,t),x(o=>o.map(s=>{if(s.id===r){const g={...s.reactions};return t?g.likes=(g.likes||0)+1:g.dislikes=(g.dislikes||0)+1,{...s,reactions:g}}return s})),j(o=>o.map(s=>s.id===r?t?{...s,likes:(s.likes||0)+1}:{...s,dislikes:(s.dislikes||0)+1}:s))}catch(o){console.error("反应操作失败:",o),a(o.message||"操作失败，请稍后重试"),l(!0)}},Me=async(r,t)=>{try{await v.toggleMessagePin(r,t),await z(),a(t?"消息已置顶":"消息已取消置顶"),l(!0)}catch(o){a(o.message||"操作失败"),l(!0)}},De=async(r,t)=>{try{const o=h?t:be(t);await v.createReply({messageId:r,userId:h?"admin":i,text:o,originalText:t}),await U(r),a("回复成功！"),l(!0)}catch(o){a(o.message||"回复失败"),l(!0)}},$e=async r=>{try{await v.deleteReply(r,i,h),m.forEach(t=>U(t.id)),a("回复删除成功！"),l(!0)}catch(t){a(t.message||"删除回复失败"),l(!0)}},Te=async(r,t)=>{console.log("Handling delete:",{messageId:r,messageUserId:t,userId:i,isAdmin:h});try{a("正在删除..."),l(!0);const o=await v.deleteMessage(r,i,h);console.log("Message deleted, success:",o),o&&(await z(),a("删除成功！"))}catch(o){console.error("删除消息时出错:",o),a(`删除失败：${o.message}`)}finally{l(!0)}},fe=()=>{R(!1),a("已退出管理员模式！"),l(!0)},Ee=(r,t,o)=>{W({open:!0,messageId:r,type:t,count:o}),ie(o)},Oe=async()=>{try{await v.updateReactionCount(_.messageId,_.type,ne)?(await z(),await A(),a(`成功修改${_.type==="likes"?"点赞":"点踩"}数量`)):a("修改反应数量失败")}catch(r){console.error("修改反应数量失败:",r),a(r.message||"修改反应数量失败")}finally{l(!0),W({..._,open:!1})}},He=()=>Z?N?e.jsxs(f,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"200px",gap:2},children:[e.jsx(p,{variant:"h6",sx:{color:"#ff69b4"},children:N}),e.jsx(y,{variant:"contained",onClick:()=>{b(null),z()},sx:{backgroundColor:"#ff69b4","&:hover":{backgroundColor:"#ff8dc3"}},children:"重试"})]}):O?e.jsxs(f,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"200px",gap:2},children:[e.jsx(he,{sx:{color:"#ff69b4"}}),e.jsx(p,{variant:"h6",sx:{color:"#ff69b4"},children:"加载中..."})]}):e.jsx(f,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"},gap:{xs:2,sm:2,md:3},width:"100%"},children:m.length>0?m.map(r=>e.jsx(wr,{messageId:r.id,message:h?r.original_text:r.text,originalText:r.original_text,onDelete:()=>Te(r.id,r.user_id),isOwner:h||r.user_id===i,isAdminMessage:r.user_id==="admin",onReact:t=>ze(r.id,t),reactions:r.reactions||{likes:0,dislikes:0},isPinned:r.is_pinned,onTogglePin:t=>Me(r.id,t),isAdmin:h,onReply:t=>De(r.id,t),replies:E[r.id]||[],onDeleteReply:$e,currentUserId:i,onEditReactions:Ee,messageUserId:r.user_id},r.id)):e.jsx(f,{sx:{gridColumn:"1 / -1",display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px"},children:e.jsx(p,{variant:"h6",sx:{color:"#ff69b4"},children:"暂无留言"})})}):e.jsxs(f,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"200px",gap:2},children:[e.jsx(he,{sx:{color:"#ff69b4"}}),e.jsx(p,{variant:"h6",sx:{color:"#ff69b4"},children:"正在初始化..."})]});return e.jsx(Rr,{children:e.jsx(Pe,{theme:_r,children:e.jsxs(f,{sx:{minHeight:"100vh",backgroundColor:"background.default",pb:"120px"},children:[e.jsx(Be,{position:"sticky",sx:{backgroundColor:"#fff0f5",border:"4px solid #ff69b4",borderBottom:"4px solid #ff69b4",boxShadow:"4px 4px 0 rgba(255, 105, 180, 0.5)",mb:3,zIndex:1100},className:"pixel-theme-pink",children:e.jsx(xe,{maxWidth:"lg",children:e.jsxs(Ne,{sx:{justifyContent:"space-between"},children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Y,{sx:{display:"flex",color:"#ff69b4",mr:1}}),e.jsx(p,{variant:"h6",className:"pixel-title-pink",sx:{color:"#ff69b4"},children:"M-Profile Lab"})]}),e.jsxs(f,{sx:{display:{xs:"none",md:"flex"},gap:2},children:[h&&e.jsx(y,{color:"inherit",startIcon:e.jsx(pe,{}),onClick:fe,className:"pixel-button-pink",sx:{color:"#ff69b4"},children:"退出管理"}),e.jsx(y,{color:"inherit",href:"./female.html",className:"pixel-button-pink",sx:{color:"#ff69b4"},children:"女M版"}),e.jsx(y,{color:"inherit",href:"./male.html",className:"pixel-button-pink",sx:{color:"#ff69b4"},children:"男M版"}),e.jsx(y,{color:"inherit",href:"./s.html",className:"pixel-button-pink",sx:{color:"#ff69b4"},children:"S版"}),e.jsx(y,{color:"inherit",startIcon:e.jsx(J,{}),href:"./gallery.html",className:"pixel-button-pink",sx:{color:"#ff69b4"},children:"图库"}),e.jsx(y,{color:"inherit",startIcon:e.jsx(ue,{}),href:"./index.html",className:"pixel-button-pink",sx:{color:"#ff69b4"},children:"返回首页"})]}),e.jsx(C,{sx:{display:{xs:"block",md:"none"},color:"#ff69b4",border:"2px solid #ff69b4","&:hover":{backgroundColor:"rgba(255, 105, 180, 0.1)"}},onClick:()=>ce(!0),children:e.jsx(We,{})})]})})}),e.jsxs(Ue,{anchor:"right",open:we,onClose:()=>ce(!1),PaperProps:{sx:{backgroundColor:"#fff0f5",width:250,border:"4px solid #ff69b4","& .MuiListItem-root":{borderBottom:"1px solid rgba(255, 105, 180, 0.2)"}}},children:[e.jsxs(f,{sx:{px:3,py:2,display:"flex",alignItems:"center",borderBottom:"2px solid rgba(255, 105, 180, 0.2)"},children:[e.jsx(Y,{sx:{color:"#ff69b4",mr:1}}),e.jsx(p,{variant:"h6",sx:{color:"#ff69b4",fontWeight:"bold"},children:"M-Profile Lab"})]}),e.jsxs(qe,{children:[h&&e.jsxs(M,{button:!0,onClick:fe,children:[e.jsx(D,{children:e.jsx(pe,{sx:{color:"#ff69b4"}})}),e.jsx($,{primary:"退出管理",sx:{color:"#ff69b4"}})]}),e.jsxs(M,{button:!0,component:"a",href:"./female.html",children:[e.jsx(D,{children:e.jsx(Qe,{sx:{color:"#ff69b4"}})}),e.jsx($,{primary:"女M版",sx:{color:"#ff69b4"}})]}),e.jsxs(M,{button:!0,component:"a",href:"./male.html",children:[e.jsx(D,{children:e.jsx(Xe,{sx:{color:"#ff69b4"}})}),e.jsx($,{primary:"男M版",sx:{color:"#ff69b4"}})]}),e.jsxs(M,{button:!0,component:"a",href:"./s.html",children:[e.jsx(D,{children:e.jsx(Y,{sx:{color:"#ff69b4"}})}),e.jsx($,{primary:"S版",sx:{color:"#ff69b4"}})]}),e.jsxs(M,{button:!0,component:"a",href:"./gallery.html",children:[e.jsx(D,{children:e.jsx(J,{sx:{color:"#ff69b4"}})}),e.jsx($,{primary:"图库",sx:{color:"#ff69b4"}})]}),e.jsxs(M,{button:!0,component:"a",href:"./index.html",children:[e.jsx(D,{children:e.jsx(ue,{sx:{color:"#ff69b4"}})}),e.jsx($,{primary:"返回首页",sx:{color:"#ff69b4"}})]})]})]}),e.jsxs(xe,{maxWidth:"lg",sx:{display:"flex",flexDirection:"column",gap:3,position:"relative",minHeight:"calc(100vh - 200px)"},children:[e.jsx(p,{variant:"h3",className:"pixel-title-pink",sx:{mb:4,cursor:"default",userSelect:"none"},onDoubleClick:Re,children:"I Love Dirty Talk"}),e.jsxs(f,{sx:{display:"flex",flexDirection:"column",gap:3,width:"100%",flexGrow:1,"& > *":{width:"100%",maxWidth:"100%"}},children:[e.jsx(f,{sx:{maxWidth:{md:"800px"},mx:"auto",width:"100%"},children:e.jsx(Ir,{messages:k})}),He()]})]}),e.jsxs(q,{component:"form",onSubmit:Ie,sx:{p:{xs:1.5,sm:2},position:"fixed",bottom:0,left:0,right:0,display:"flex",gap:{xs:1,sm:2},alignItems:"center",backgroundColor:"#fff0f5",zIndex:1e3,borderTop:"4px solid #ff69b4",boxShadow:"0 -4px 0 rgba(255, 105, 180, 0.5)",maxHeight:"120px",overflowY:"auto"},className:"pixel-theme-pink",children:[e.jsx(G,{fullWidth:!0,multiline:!0,rows:2,value:d,onChange:r=>I(r.target.value),placeholder:"说点什么...(最多200字)",variant:"outlined",inputProps:{maxLength:200},helperText:`${d.length}/200`,sx:{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#ff69b4",borderWidth:"3px"},"&:hover fieldset":{borderColor:"#ff69b4"},"&.Mui-focused fieldset":{borderColor:"#ff69b4"}}}}),e.jsx(y,{type:"submit",variant:"contained",endIcon:e.jsx(ve,{}),sx:{height:"100%",minWidth:{xs:"80px",sm:"100px"},backgroundColor:"#ff69b4",color:"white","&:hover":{backgroundColor:"#ff8dc3"}},className:"pixel-button-pink",children:"发送"})]}),e.jsxs(Fe,{open:_.open,onClose:()=>W({..._,open:!1}),children:[e.jsxs(Ve,{sx:{color:"#ff69b4"},children:["修改",_.type==="likes"?"点赞":"点踩","数量"]}),e.jsx(Ze,{children:e.jsx(G,{autoFocus:!0,margin:"dense",label:`${_.type==="likes"?"点赞":"点踩"}数量`,type:"number",fullWidth:!0,value:ne,onChange:r=>ie(parseInt(r.target.value)||0),inputProps:{min:0},sx:{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#ff69b4"},"&:hover fieldset":{borderColor:"#ff69b4"},"&.Mui-focused fieldset":{borderColor:"#ff69b4"}}}})}),e.jsxs(Ae,{children:[e.jsx(y,{onClick:()=>W({..._,open:!1}),sx:{color:"#ff69b4"},children:"取消"}),e.jsx(y,{onClick:Oe,sx:{backgroundColor:"#ff69b4",color:"white","&:hover":{backgroundColor:"#ff8dc3"}},children:"确认"})]})]}),e.jsx(Ye,{open:n,autoHideDuration:3e3,onClose:()=>l(!1),message:T})]})})})}Ge.createRoot(document.getElementById("root")).render(e.jsx(ge.StrictMode,{children:e.jsx(zr,{})}));
